FROM node:20-slim

WORKDIR /app

COPY package*.json ./

RUN npm ci

COPY . .

# Générer le client Prisma si le fichier schema existe
RUN if [ -f "prisma/schema.prisma" ]; then npx prisma generate; fi

RUN npm run build

EXPOSE 3000

ENV NUXT_HOST=0.0.0.0
ENV NUXT_PORT=3000

CMD ["node", ".output/server/index.mjs"]
